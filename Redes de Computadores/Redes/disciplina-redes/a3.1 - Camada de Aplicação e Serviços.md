# Aula 3 - Camada de Aplica√ß√£o e Servi√ßos

> https://www.youtube.com/watch?v=_GbYV8AvRI8&list=PL0FCIqMLw_fQGQqvGFbVj9CImAypTa4ub&index=4
## Camada de Aplica√ß√£o
- Aplica√ß√µes cl√°ssica de textos (1970 e 1980)
	- Correio eletr√¥nico (SMTP, POP3 e IMAP)
	- Acesso remoto a computadores (TELNET)
	- Transfer√™ncia de Arquivo (FTP)
	- Grupos de discuss√£o (NNTP)
- A World Wide Web (HTTP) alcan√ßou sucecsso estrondoso em meados da d√©cada de 90
	- Sistemas de busca (Altavista, Google, Bing, Yahoo, etc.)

### Princ√≠pios da aplica√ß√£o de rede
- Desenvolver aplica√ß√µes de rede √© escrever programas que:
	- Executem em sistemas finais diferentes e se comuniquem entre si
- Programas podem ser completamente diferente mas se comunicam pelo protocolo HTTP (arquitetura cliente servidor);
	- Tamb√©m pode ser id√™nticos (ccomo algumas aplica√ß√µes P2P - ex.: bitTorrent)
- N√£o √© necess√°rio programar nada nos n√≥s intermedi√°rios, apenas nos dispositivo que se comunicam (finais).
- Camada de aplica√ß√£o (fim a fim): uma aplica√ß√£o fala direto com outra aplica√ß√£o.

### Arquitetura de aplica√ß√£o
- Projetada pelo programador e determina como a aplica√ß√£o √© organizada nos sitemas finais.
- As arquiteturas mais utilizadas s√£o:
	- Cliente-servidor
	- P2P - ponta a ponta entre os proprios dispositivos

#### Cliente-servidor
- H√° um hospedeiro - servidor - sempre em funcionamento, que atende requisi√ß√µes de outro hospedeiro - cliente.
	- os clientes n√£o se comunicam diretamente uns com outros
	- servidor possui endere√ßo fixo bem conhecido(normalmente)
- Muitas vezes, um √∫nico servidor n√£o √© capaz de atender todas as requisi√ß√µes
	- como solu√ß√£o, com frequencia um **datacenter** acomodando uma grande quantidade de hospedeiros √© usado para criar um servidor virtual poderos.
- Um **datacenter** pode ter centanass de milhares de servidores
	- Precisam ser alimentados e precisam de interconex√£o (redundante e com alta largura de banda)

---
## Servi√ßos de Transporte providos pela internet
#### UDP vs TCP

| Aplica√ß√£o                    | Protocolo de Camada de Aplica√ß√£o              | Protocolo de Transporte subjacente |
| ---------------------------- | --------------------------------------------- | ---------------------------------- |
| Correio eletr√¥nico           | SMTP                                          | TCP                                |
| Acesso a terminal remoto     | Telnet                                        | TCP                                |
| Web                          | HTTP                                          | TCP                                |
| Transfer√™ncia de Arquivos    | FTP                                           | TCP                                |
| Multim√≠dia em fluxo cont√≠nuo | HTTP (por exemplo, YouTube)                   | TCP                                |
| Telefonia por internet       | SIP, RTP, ou proprietaria (por exemplo Skype) | UDP ou TCP                         |
| Gerenciamento de Rede        | RIP                                           | Tipicamente UDP                    |
| Servidor de Arquivo Remoto   | NFS                                           | Tipicamente UDP                    |
| Protocolo de Roteamento      | RIP                                           | Tipicamente UDP                    |
| Tradu√ß√£o de nome             | [[DNS]]                                       | Tipicamente UDP                    |
- V√≠deos pr√© armazenados: TCP
- V√≠deo em tempo real: UDP

> RFC INDEX
> - https://www.rfc-editor.org/rfc-index.html

---
## Servi√ßo DNS (Domain Name System)
- Domain Name System: [[DNS]]
	- Nome -> IP 
	- IP -> nome (reverso)
	- Implementa [[12. Sockets|UDP]]

---
## Servi√ßo WEB
- Permite acesso a documentos vinculados e espalhados por milhares de hospedeiros na internet.
### Breve hist√≥ria
- Nasceu na CERN, da necessidade de compartilhar relat√≥rios cinet√≠ficos, plantas, desenhosm fotos e outros documentos.
- 1991: modo texto apresentado na Hypertext'91
- Primeira interface grafic em 1993: Mosaic

### üìÑ P√°gina WEB
- Documento - contru√≠do por objetos:
	- Um objeto pode ser:
		- Arquivo HTML
		- Imagem
		- applet Java
		- V√≠deo
		- etc.
- A maioria das p√°gina web s√£o cosntru√≠das em um arquivo base HTML e diversos objetos referenciados.
#### URL: Uniform Resource Locator
- O arquivo-base HTML referencia outros objetos na p√°gina com os **URLs** (*Uniform Resource Locator* - Localizador Uniforme de Recursos) dos objetos

- Cada URL tem dois componentes:
	- *nome de hospedeiro* que abriga o objeto
	- *nome do caminho* do objeto
- ex.: http://www.gnu.org/graphics/heckert_gnu.transp.small.png
	- nome do hospedeiro: `www.gnu.org`
		- n√£o faz diferen√ßa entre maiusculo e minusculo
	- nome do caminho `/graphics/heckert_gnu.transp.small.png`
		- depende da maquina (windows ou unix)
			- windows: faz diferen√ßa ser maiuscula/minuscula
			- unix: n√£o faz diferen√ßa ser maiuscula/minuscula

### üåê HTTP - HyperText Transfer Protocol
- Protocolo de Transfer√™ncia de Hipertexto
	- √â definido no RFC 1945 e no RF 2616

- √â executado tanto no cliente quanto no servidor
- *Define a estrutura das mensagens trocadas e o modo como o cliente e o servidor trocam as mensagens*.

- Quando um usu√°rio requisita uma pagina web, o *navegador* envia ao servidor **mensagens de requisi√ß√£o HTTP** para os objetos da p√°gina.
- O servidor recebe as requisi√ß√µes e responde com **mensagens de resposta HTTp** que cont√©m os objetos.

- O HTTP **usa o TCP** como seu protocolo de transporte subjacente
- O Cliente HTTP inicia uma conex√£o TCP com o servidor
	- Os processos do navegador e do servidor acessam o TCP por meio de suas interfaces de [[12. Sockets|Sockets]].

> Como usa o TCP, o HTTP n√£o precisa se preocupar com dados perdidos ou detalhes de como se recuperar da perda de dados ou os reordenar.

<img src="https://miro.medium.com/v2/resize:fit:697/1*fPLxbzS5zdJlKrzxf4VVXQ.png">

- O servidor envia ao cliente os arquivos solicitados sem armazenar qualquer informa√ß√£o de estado sobre o cliente
	- O HTTP √© denominado um protocolo **sem estado** 
	- Simplifica o projeto;
	- Permite manipular milhares de conex√µes simult√¢neamente;
	
> [!NOTE] HTTP: protocolo sem Estado
> N√£o guarda um registro das a√ß√µes do cliente que trar√° condi√ß√£o de resposta - ele n√£o armazena estado e n√£o se importa com estados do cliente; Cada pergunta √© individual - n√£o interessa se √© a primeira pergunta, etc. O servidor web vai interagir como se fosse sempre a primeira pergunta

- A web usa **arquitetura de aplica√ß√£o Cliente-Servidor**
	- Um servidor Web estar√° sempre funcionando, tem um endere√ßo IP fixo, trabalha sempre na mesma porte (porta 80), e pode atender requisi√ß√µes de milh√µes de navegadores diferentes.

- O programador da aplica√ß√£o precisa tomar uma importante decis√£o:
	- *Cada par de requisi√ß√£o/resposta deve ser enviado por uma conex√£o TCP distinta?*
		- ==Conex√µes n√£o persistentes==
	- *Ou todas as requisi√ß√µes e suas respostas devem ser enviadas por uma mesma conex√£o TCP?*
		- ==Conex√£o persistente== (menos carga no servidor) - modo padr√£o

#### M√©todos HTTP

| M√©todo | Descri√ß√£o                                                       |
| ------ | --------------------------------------------------------------- |
| *GET   | Solicita a leitura de uma p√°gina/objeto Web                     |
| HEAD   | Solicita a leitura de um cabe√ßalho de p√°gina/objeto Web         |
| *PUT   | Solicita o armazenamento de uma p√°gina/objeto da Web            |
| *POST  | Acrescenta a um recurso (por exemplo, uma p√°gina Web ou objeto) |
| DELETE | Remove a p√°gina/objeto da Web                                   |
| LINK   | Conecta dois recursos existentes                                |
| UNLINK | Desfaz uma conex√£o entre dois recursos                          |
#### Formato da Mensagem HTTP

- **Exemplo de Mensagem de Requisi√ß√£o HTTP**
```HTTP
GET /software/software.html HTTP/1.1 
Host: www.gnu.org
Connection: close
User-agent: Mozilla/5.0 
Accept-language: pt-BR

```

- A primeira linha √© a linha de requisi√ß√£o
	- Possui 3 campos: 
		- M√©todo
		- URL
		- HTTP
- As linhas subsequente s√£o de cabe√ßalho



- A mensagem de requisi√ß√£o √© escrita em texto ASCII comum.
- No excemplo √© constitu√≠da de cinco linhas, cada qual seguida de um *carriage return e *line feed*.
- A √∫ltima linha √© seguida de um comando adicional de *carriage return* e *line feed*

- **Exemplo de Mensagem de Resposta HTTP**
```HTTP
HTTP/1.1 200 OK
Connection: close
Date: Tue, 09 Aug 2011 15:44:04 GMT
Server: Apache/2.2.3 (CentOS)
Last-Modified: Tue, 09 Aug 2011 15:11:03 GMT
Content-Length: 6821
Content-Type: text/html
(dados...)

```

- linha 1: protocolo da resposta + c√≥digo de retorno (200) + Srting do c√≥digo
- linha 2: encerramento da transmiss√£o
- linha 3: data da resposta
- linha 4: servidor (web apache vers√£o 2.2.3 rodando em um OS CentOS)
- linha 5: quando o recurso solicitado foi modificado pela ultima vez
- linha 6: tamanho do recurso em byte
- linha 7: tipo de recurso enviado
- linha 8: representa√ß√£o dos dados retornados

### üç™ Cookies
- Rastreamento dos clientes armazenado em servidores 

- Um servidor HTTP n√£o tem estado
	- No entanto √© bom que um site identifique seus usu√°rios para apresentar conte√∫do em fun√ß√£o da identidade do usu√°rio.
	- Para isso s√£o utilizados os cookies (definidos em RFC 6265)

- Exemplo
	- Um hospedeiro que ja visitou o *ebay* antes possui um cookie registrado: `8734`
	- O usuario acessa o site da *amazon* mandando uma mensagem de requisi√ß√£o http para acessar o site - o cookie do ebay n√£o √© enviado na mensagem, pois os cookies do ebay s√£o restritos ao ebay. 
	- Um cookie s√≥ ser√° atribu√≠do ao cliente que acessar a amazon pela primeira vez da seguinte forma:
		- amazon verifica se foi enviado algum cookie, se n√£o, primeira vez do usuario:
			- o servidor cria um ID `1678` para o usuario
			- o servidor manda a mensagem de resposta http junto com o comando:
				- `Set-cookie: 1678` - ao aceitar os cookies, o navegar armazena o cookie em um pequeno banco de dados.
	- Ao acessar novamente a amazon em outra visita, o cliente envia a requisi√ß√£o http junto com o cookie - assim o hospedeiro servidor sabe que voc√™ acessou.
	- A cada acesso o hospedeiro cliente envia a requisi√ß√£o http junto do cookie - a amazon consulta seu cookie no banco de dados dela, e verifica suas informa√ß√µes, assim ela pode fazer um rastreio e mapeamento do seu usuario - a√ß√µes espec√≠ficas do cookie - o estado √© guardado pela aplica√ß√£o (e n√£o pelo http).

<img src="data:image/png;base64,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">

### üóÉ Cache Web (servidor proxy)

> - Importante para aplica√ß√£o empresarial
> - Faz parte do sistema Firewall da rede
> - Pode conter anti virus, regras de uso, etc (limitar acesso √† certas p√°ginas e servi√ßos web por exemplo); 

- Cache web (servidor proxy) √© uma entidade da rede que atende requisi√ß√µes HTTP.
- Tem sua pr√≥pria unidade de **armazenamento** e mant√©m c√≥pias de objetos *recentemente* requisitados - caso maquinas tentem acessar futuramente a mesma informa√ß√£o ser√° mais r√°pido.
	- o navegador estabele uma conex√£o TCP com o cache web e envia a ele uma *requisi√ß√£o* http para o objeto.
	- o chace web verifica se j√° possui uma c√≥pia do objeto armazenada localmente.
	- se tiver, ele envia o objeto ao navegador por meio de uma resposta HTTP
	- se n√£o tiver, o cache web abre uma conex√£o TCP com o Servidor Web, envia uma requisi√ß√£o HTTP e aguarda que o servidor envie o objeto dentro de uma resposta HTTP.
	- quando recebe, ele **guarda uma c√≥pia do objeto no armazenamento local** e ent√£o envia outra, dentro de uma mensagem de resposta HTTP ao cliente.


<img src="https://developer.mozilla.org/pt-BR/docs/Web/HTTP/Caching/request-collapse.png">

- O navegador de um usu√°rio pode ser configurado de modo que todas as suas requisi√ß√µes HTTP sejam dirigidas ao cache Web.
#### vantagens
- reduzir o tempo de resposta para a requisi√ß√£o de um cliente
- reduzir o tr√°fego no enlace de aceso de uma instiui√ß√£o qualquer √† internet.
- reduzir o tr√°fego na internet - melhorando desempenho para todas as aplica√ß√µes.

#### caso particular: GET condicional

> A utiliza√ß√£o de cache introduz um novo problema: *a c√≥pia de um objeto existente no cache pode estar desatualizada*

- E se uma informa√ß√£o for atualizada no servidor? Ela n√£o √© atualizada na cache e deixa de ser v√°lida?
- Para isso existe o **GET condicional**

- O GET condicional √© um mecanismo do HTTP que permite que um cache verifique se seus objetos est√£o atualizadoss.
	- Posui uma linha de cabe√ßalho: `If-modified-since`

- Quando o cache web recebe uma solicita√ß√£o e j√° possui o objeto, ele envia uma solicita√ß√£o contendo a data do objeto que possui em cache. Exemplo:
```HTTP
GET /fruit/kiwi.png HTTP/1.1
Host: www.frutas.com
If-modified-since: Wed, 7 Sep 2011 09:23:24
```
- Se a informa√ß√£o ainda for v√°lida √© retornado o c√≥digo 304, e o objeto √© usado normalmente:
```HTTP
HTTP/1.1 304 Not Modified
Date: Sat, 15 Oct 2011 15:39:29
Server: Apache/1.3.0 (Unix)
(corpo de mensagem vazio)
```

- Squid (open source) - https://www.squid-cache.org/
	- Squidguard (open source)
- Servi√ßos de proxy pago
	- empresas verificam e categorizam sites para configura√ß√£o de proxy
### üìÅ FTP (Transfer√™ncia de Arquivo)
- O Protocolo oficial de transfer√™ncia de arquivos na Internet √© o FTP (File Tranfer Protocol);
- Transporte fim a fim confi√°vel, como o TCP;

- Al√©m da fun√ß√£o de transfer√™ncia ele tamb√©m oferece:
	- Acesso interativo
	- Especifica√ß√£o de formato (representa√ß√£o - modo texto, modo bin√°rio)
	- Controle de autentica√ß√£o

- Usa o TCP para conectar os cliente ao processo servidor, que aguarda conex√µes e cria processos escravos para tratar cada conex√£o.
	- O escravo aceita e trata a conex√£o de controle do cliente, mas usa **processos adicionais** para tratar uma conex√£o de transfer√™ncia de dados √† parte.
		- A **conex√£o controle** transporta comandos que informam ao servidor qual arquivo transferir;
		- A **conex√£o de transfer√™ncia** de dados realiza as transfer√™ncias de dados.

![[FTP|100%]]

- As conex√µes de **transfer√™ncia de dados** podem ser criadas **dinamicamente**, mas as **conex√£o de controle persiste** atrav√©s da sess√£o.
- Uma vez que a conex√£o de controle dessaparece, a sess√£o √© finalizada e o software de ambas as extremidades encerra todos os processos de transfer√™ncia de dados.

- Conex√£o incial e controle: porta 21 do TCP
- Tranfer√™ncia de dados: porta 20 do TCP

### üì¨ Correio Eletr√¥nico

> [!Breve Hist√≥ria]
> - No in√≠cio os sistemas de correio eletr√¥nico eram simplesmente transfer√™ncia de arquivos texto.
> - N√£o era conveniente envio para um grupo de pessoas.
> - As mensagens n√£o tinham estruturas internas, dificultando o processamento - lento.
> - O remetente nunca sabia se uma mensagem havia chegado ou n√£o.
> - N√£o era poss√≠vel enviar texto e multim√≠dia juntos.
> - Corre√ß√£o em 1982 - RFC 821 e RFC 822

Existem 3 componentes principais:
- Os agentes de usu√°rio
- O servidores de correio
- O **SMTP** (Simple Mail Transfer Protocol)

- **Agentes Usu√°rios** permitem que usu√°rios leiam, respondam, encaminhem, salvem e componham mensagens - ao final da mensagem o agente usu√°rio envia ao seu **servidor de correio** (local - cada usu√°rio posuim seu pr√≥prio servidor), onde a mensagem √© colocada em sua fila de mensagens de sa√≠da.
- Para ler uma mensagem o agente busca a mensagem em uma caixa de correio, no servidor de correio eletr√¥nico.

![[mail-service|100%]]

- **Servidores de correio** formam o n√∫cleo da infraestrutura do e-mail.
	- A maioria dos servidores obrigado o agente usu√°rio a utilizar https por seguran√ßa;
- Cada destinat√°rio tem uma **caixa postal** (caixa de entrada) localizada em um desses servidores.
- O Agente usu√°rio escreve sua mensagem, envia por meio de SMTP para o servidor de correio eletr√¥nico local. Quando o servidor recebe a mensagem ele faz verifica√ß√µes e processamentos internos (detec√ß√£o de spam, v√≠rus, etc), por fim ele envia ao servidor de correio eletr√¥nico do destinat√°rio usando SMTP (que tamb√©m faz a verifica√ß√£o e processamento interno).

#### üì®¬†SMTP
- RFC 5321 - RFC 7504
- Tecnologia antiga que possui certas caracter√≠sticas arcaicas
	- Exemplo: restringe o corpo e o cabe√ßalho de todas as mensagens ao simples formato de ASCII de 7 bits (exige que dados bin√°rios sejam codificados em ASCII)

##### FUNCIONAMENTO
- O cliente SMTP faz o TCP estabelecer uma conex√£o na porta 25 comm o servidor SMTP.
- Uma vez estabelecida a conex√£o, o servidor e o cliente trocam alguns procedimentoss de apresenta√ß√£o antes de transferir informa√ß√µes.
	- Durante essa fase, o cliente SMPT indica os endere√ßos de e-mail do remetente e destinat√°rio. Somente depois √© realizado o envio da mensagem.

- O cliente repetir√° ese processo, na mesma conex√£o TCP, se houver outras mensagens a enviar ao servidor.
- Se n√£o houver mais mensagens a enviar o cliente ecerrar√° a conex√£o.

> [!NOTE] Observa√ß√£o: Seguran√ßa em rede
> Quando fazemos a conex√£o pelo FTP (Transfer√™ncia de Arquivos) fornecemos usu√°rio e senha, e ao fazer a transmiss√£o esses dados s√£o encaminhados. Se algu√©m utilizar um socket sniffer no caminho, ele poder√° capturar essa informa√ß√£o. Para isso, utilizamos o SFTP (que utiliza a camada de seguran√ßa do SSH - criptografia das mensagems). O mesmo vale para o SMTP com a utiliza√ß√£o do SMTPS, que tamb√©m utiliza o SSH.

- A mensagem de email possui um cabe√ßalho com informa√ß√µes de envio (to, subject, from - algumas obrigat√≥rias e outras opcionais);

- Cabe√ßalhos - mensagens importantes para o servidor de correio

| Cabe√ßalho    | Significado                                                                                                                                               |
| ------------ | --------------------------------------------------------------------------------------------------------------------------------------------------------- |
| To:          | Endere√ßo de correio eletr√¥nico do(s) destinat√°rio(s) principal(is)                                                                                        |
| Cc:          | Endere√ßo de correio eletr√¥nico dos destinat√°rioss secund√°rios                                                                                             |
| Bcc:         | Endere√ßo(s) de correio eletr√¥nico para c√≥pias carbono cegas/ocultas (c.c.o.)                                                                              |
| From:        | Pessoa(s) que criou(aram) a mensagem                                                                                                                      |
| Sender:      | Endere√ßo de email do remetente                                                                                                                            |
| Received:    | A linha que √© inclu√≠da por cada agente de transfer√™ncia durante o percurso - sempre que a transmiss√£o passa um ponto da rede √© adicionado esse cabe√ßalho. |
| Return-Path: | Identifica o endere√ßo de email para onde enviar relat√≥rios de erros em caso de falha na netrega da mensagem.                                              |

```
From: alice@crepes.fr
To: bob@hamburger.edu
Subject: Buscando o significado da vida.
```

- As mensagens tamb√©m podem conter uma variedade de campos de cabe√ßalho uteis aoss agentes usu√°rios/destinat√°rios; Os mais comuns s√£o:
	- Date
	- Reply-to
	- Message-Id
	- In-Reply-To
	- References
	- Keyword
	- Subject

- Ap√≥s o cabe√ßalho vem uma linha em branco, seguida pelo corpo da mensagem em ASCII.

#### üì• Protocolos de Acesso
*QUAL CAMINHO DE UMA MENSAGEM?*
1. Agente comp√µem a mensagem
2. A mensagem √© enviada para o servidor de correio local por meio de SMTP
3. O servidor de correio analisa e faz verifica√ß√µes, enviando por SMTP ao servidor de correio destinat√°rio
4. O servidor de correio aloca a mensagem na caixa postal.
5. Quando o Agente receptor quiser consultar ele utiliza protocolos POP3 ou IMAP (protocolos de consulta).

##### üì© ==POP3 (POST OFFICE PROTOCOL version 3)==

- Abre uma conex√£o com o servidor e coleta para o agente do usu√°rio, para somente assim fazer as manipula√ß√µes.
<img src="https://www.jscape.com/hubfs/images/smtp_imap_pop3.png">

- Estabelece uma conex√£o TCP com o servidor na *porta 110*.
- Depois que a conex√£o √© estabelecida o protocolo passa por tr√™s estados na sequ√™ncia:
	- Autoriza√ß√£o: lida com o login do usu√°rio;
	- Transa√ß√£o: lida com a coleta de mensagem / marca√ß√£o de exclus√£o de mensagem;
	- Atualiza√ß√£o: faz com que as mensagens marcadas sejam efetivamente exclu√≠das.
- Com isso ele pode baixar mensagens espec√≠ficas e tamb√©m eliminar as que n√£o s√£o mais desejadas - RFC 1939.

> Para um usu√°rio com uma conta de correio eletr√¥nico que √© sempre acessada a partir de um √∫nico computador o POP3 funciona bem - as mensagens ficam armazenadas localmente em um √∫nico computador.
##### ‚úâÔ∏è ==IMAP (INTERNET MESSAGE ACCESS PROTOCOL)==

> Para pessoas que querem acessar a partir de mais de um local, o POP3 j√° n√£o √© mais t√£o adequado - pois as mensagens do usu√°rio ficar√£o espalhadas por v√°rias m√°quinas.

- O IMAP pressup√µe que todas as mensagens permanencem no servidor (ao em vez de serem puxadas para o agente como no POP3), e fornece mecanismos para leitura de mensagens dentro do mesmo.

- Tamb√©m fornece mecanismos para **criar**, **destruir** e **manipular** v√°rias caixas de correio ==diretamente no servidor== - ao contr√°rio do POP3, o IMAP n√£o copia as mensagens para a m√°quina pesssoal do usu√°rio.

- O IMAP espera por conex√µes de clientes na porta 143 do TCP.

#### Webmail
- Forma com que os websites fornecem aos usu√°rios o acesso as mensagens de correio eletr√¥nico.
- Identifica√ß√£o e senha
- A partir desse sistema temos acesso imediato √†s mensagens ao IMAP
	- O webmail √© uma interface web para o IMAP.

#### Privacidade em Correio Eletr√¥nico
- HTTPS fornece privacidade apenas durante a transmiss√£o da mensagem, fora isso as mensagens podem ser capturadas de forma descriptografada.
- Por isso o seguro √© criptografar antes do envio - no momento da montagem da mensagem.
- Quando a mensagem for decriptografada no servidor pelo HTTPS ela continuar√° criptografada.

- Para isso tems softwares especializados na prote√ß√£o e criptografia:
	- PGP (Pretty Good Privacy)
	- PEM (Privacy Enhanced Mail)
	- GPG (GNU Privacy Guard)

<img src="https://m.media-amazon.com/images/I/71x3ued-CWL._AC_UF1000,1000_QL80_.jpg" width="28%">
